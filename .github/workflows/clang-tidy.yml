name: clang-tidy

on:
  push:
    branches: [ main ]
  pull_request:

jobs:
  analyze:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install clang-tidy
        run: sudo apt-get update && sudo apt-get install -y clang-tidy
      - name: Run clang-tidy on C sources
        run: |
          git ls-files '*.c' | xargs -n 1 clang-tidy \
            --quiet \
            --warnings-as-errors=clang-analyzer-security.insecureAPI.strcpy,clang-analyzer-security.insecureAPI.strcat
